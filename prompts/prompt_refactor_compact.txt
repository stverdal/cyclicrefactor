# Compact Refactor Prompt (for low-VRAM / small context LLMs)

Break the cyclic dependency using SEARCH/REPLACE patches.

## Cycle: {id}
Graph: {graph}
Files: {files}

## Description
{description}

## Strategy: {strategy}

## Source Code
{file_snippets}

---

## Output Format (JSON)

```json
{{
  "reasoning": "<brief explanation>",
  "strategy_used": "<interface_extraction|dependency_inversion|shared_module>",
  "new_files": [
    {{"path": "Interfaces/IFoo.cs", "content": "<complete file content>"}}
  ],
  "changes": [
    {{
      "path": "path/to/existing_file",
      "search_replace": [{{"search": "<3+ lines from source>", "replace": "<new code>"}}],
      "prepend": "<NEW using statements>"
    }}
  ]
}}
```

## CRITICAL RULES

1. **SEARCH must match source EXACTLY** - Copy verbatim from Source Code above
2. **Include 3+ context lines** - Before AND after the changed code
3. **Preserve whitespace** - Exact indentation matters
4. **NEW FILES** - Use `"new_files": [{{"path": "...", "content": "..."}}]` for new interfaces/classes
5. **NEW IMPORTS** - Use `"prepend": "using ...;"` to add imports to existing files
6. **DO NOT search for non-existent text**

❌ BAD: `"search": "public void Method()"`  (no context)
❌ BAD: `"search": "// Add interface here"` (doesn't exist)
✅ GOOD: `"new_files": [{{"path": "Interfaces/IFoo.cs", "content": "namespace X {{ interface IFoo {{ }} }}"}}]`

Output ONLY JSON. No commentary.
